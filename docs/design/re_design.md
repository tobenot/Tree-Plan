好的，我们现在将所有讨论收束，沉淀为一份清晰、可执行的**技术功能设计稿**。

这份设计稿将作为你开发过程中的蓝图和检查清单。

---

### **项目技术功能设计稿 (V1.0)**

**版本:** 1.0
**日期:** 2025年7月3日

#### **1. 项目核心理念与架构**

* **核心理念:** 本项目是一个**个人思想的编辑器与发布系统**。其核心是构建一个结构化、网络化的个人知识库（"树计划"），并将其以静态网站的形式分享出去。
* **核心架构:** 采用**"Git as a CMS"**模式，实现本地编辑与静态部署的分离。
    * **应用A (本地编辑器):** 一个运行在本地开发环境的、功能丰富的 Tiptap 编辑器，用于创建和维护知识内容。
    * **应用B (公开静态网站):** 一个通过 GitHub Pages 部署的、高性能的、只读的网站，用于公开展示和分享知识内容。

#### **2. 技术栈**

* **前端框架:** React (使用 Vite 构建)
* **编辑器核心:** Tiptap
* **数据格式:** JSON
* **数据存储:** 项目 Git 仓库内的单个 JSON 文件 (e.g., `src/data/notes.json`)
* **部署方案:** GitHub Actions + GitHub Pages

---

#### **3. 功能模块详细设计**

##### **3.1. 数据模块**

* **3.1.1. 数据格式:**
    * 采用 **Tiptap 原生 JSON 格式**。
    * 编辑器直接消费和产出其标准的 JSON 结构，不再使用自定义的树状结构。这简化了数据处理流程，并能更好地利用 Tiptap 的内置功能。

* **3.1.2. 数据存储:**
    * 项目源码中包含一个规范的、作为唯一数据源的 JSON 文件（`src/data/notes.json`）。
    * 该文件与代码一同接受 Git 版本控制。

##### **3.2. 本地编辑器应用 (应用A)**

* **3.2.1. 编辑器核心 (Tiptap):**
    * 必须以"块编辑"模式运行，每一个大纲条目都是一个独立的、可操作的节点。
    * 编辑器需要能够加载 `notes.json` 文件内容作为其初始状态。

* **3.2.2. 大纲操作功能 (Keyboard-First):**
    * 必须实现以下核心键盘快捷键，以模拟主流大纲笔记软件的体验：
        * **`Enter`**: 在当前节点下方创建一个新的同级节点。
        * **`Tab`**: 将当前节点缩进，使其成为上方节点的子节点。
        * **`Shift+Tab`**: 将当前节点取消缩进，使其层级提升。
        * **`Backspace` (在空节点行首)**: 删除当前节点，并将光标移动到上一个节点末尾。

* **3.2.3. 数据导出功能:**
    * 编辑器界面必须提供一个明确的 **"导出/更新笔记"** 按钮。
    * 点击该按钮后，应用需将编辑器当前的状态转换为格式化后的 JSON 字符串。
    * 该字符串需以一种便捷的方式提供给用户（例如，打印在控制台或直接下载文件），以便用户能**手动**用其覆盖 `src/data/notes.json` 文件。

* **3.2.4. 链接系统 (自动扫描):**
    * **[Phase 1: 自动扫描]** 项目包含一个独立的 Node.js 脚本 (`scripts/generate-links.js`)，用于自动发现潜在链接。
    * **[Phase 2: 触发机制]** 该脚本可通过 `npm run link` 命令手动触发，并且已集成到 `npm run build` 命令中，确保每次构建和部署前都会自动运行。
    * **[Phase 3: 链接逻辑]** 脚本会扫描 `src/data/notes.json` 文件中所有的笔记条目。当发现两个或多个条目的文本内容完全相同时，它会自动为这些条目在 JSON 数据中添加一个特殊的链接标记（`autoLink` Mark）。
    * **[Phase 4: 链接可视化]** 在编辑器中，所有被自动标记为链接的文本都应有独特的视觉样式（例如，不同的颜色或下划线），以区别于普通文本。这通过一个轻量的 Tiptap 扩展 (`AutoLink.ts`) 实现。

##### **3.3. 公开静态网站 (应用B)**

* **3.3.1. 数据源:**
    * 网站的构建过程必须以 Git 仓库中**已提交**的 `src/data/notes.json` 文件作为唯一数据输入。

* **3.3.2. 页面渲染:**
    * 网站为一个单页面应用 (SPA)。
    * 所有笔记内容需在页面加载后，通过 JavaScript 将 JSON 数据渲染为可视的、层级化的 HTML 列表 (`<ul>`/`<li>`)。
    * 整个网站必须是**只读**的，不存在任何编辑功能。

* **3.3.3. 链接展示:**
    * 所有在数据中被标记为链接的文本，在公开网站上必须渲染为可交互的 `<a>` 标签或具有特殊样式的 `<span>`。
    * 点击链接后的交互行为可后续定义（例如，页面内滚动到对应条目，或高亮所有同名条目）。

##### **3.4. 部署与工作流模块**

* **3.4.1. 自动化流程:**
    * 必须配置一个 GitHub Actions workflow 文件 (`.github/workflows/deploy.yml`)。
* **3.4.2. 触发条件:**
    * 该 workflow 必须在 `main` (或指定) 分支接收到 `push` 事件时自动触发。
* **3.4.3. 自动化任务:**
    * 工作流必须按顺序执行以下任务：
        1.  检出 (Checkout) 代码。
        2.  安装 Node.js 环境。
        3.  安装项目依赖 (`npm install`)。
        4.  运行构建命令 (`npm run build`)，生成 `dist` 文件夹。
        5.  将 `dist` 文件夹的内容部署到 GitHub Pages。